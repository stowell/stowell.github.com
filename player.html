<!DOCTYPE HTML>
<html>
<head>
  <title>jquery.rdio test</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
  <script src="/jquery.rdio.js"></script>
  <script type="text/javascript">
    var duration = 1; // track the duration of the currently playing track
    $(document).ready(function() {
      // $('#api').bind('ready.rdio', function() {
      //   $(this).rdio().play('a1938183');
      // });
      $('#api').bind('playingTrackChanged.rdio', function(e, playingTrack, sourcePosition) {
        if (playingTrack) {
          duration = playingTrack.duration;
          $('#art').attr('src', playingTrack.icon);
          $('#track').text(playingTrack.name);
          $('#album').text(playingTrack.album);
          $('#artist').text(playingTrack.artist);
        }
        });
      $('#api').bind('positionChanged.rdio', function(e, position) {
        $('#position').css('width', Math.floor(100*position/duration)+'%');
      });
      $('#api').bind('playStateChanged.rdio', function(e, playState) {
        if (playState == 0) { // paused
          $('#play').show();
          $('#pause').hide();
        } else {
          $('#play').hide();
          $('#pause').show();
        }
      });
      $('#api').rdio('GApQsVp7_____2Nyd2I5N3B4ajJ4YmUyYnI0cm1mZHZqd3N0b3dlbGwuZGVHdp3dh4YghzTYrK2W07WZ');

      $('#previous').click(function() { $('#api').rdio().previous(); });
      $('#play').click(function() { $('#api').rdio().play(); });
      $('#pause').click(function() { $('#api').rdio().pause(); });
      $('#next').click(function() { $('#api').rdio().next(); });
    });
  </script>
  <script type="text/javascript">
    $(document).ready(function(){
      var api_key = 'D4ELP5JGEUVXNPMS8';
      var tp = 'CANFQLO13B3A2EE3EB';
      $('#api').bind('ready.rdio', function() {
        console.log('ready.rdio');
        $.getJSON(
          'http://developer.echonest.com/api/v4/playlist/dynamic/create',
          {
            'type': 'catalog-radio',
            'adventurousness': 0.8,
            'seed_catalog': tp,
            'session_catalog': tp,
            'bucket': ['id:rdio-US', 'tracks'],
            'artist': 'tame impala',
            'limit': true,
            'api_key': api_key
          },
          function(data) {
            console.log('dynamic/create');
            var response = data.response;
            session_id = response.session_id;
            $.getJSON(
              'http://developer.echonest.com/api/v4/playlist/dynamic/next',
              {
                'api_key': api_key,
                'results': 5
              },
              function(data) {
                console.log('dynamic/next');
                var response = data.response;
                songs = response.songs;
                $.each(songs, function(i, song){
                  var fid = song.tracks[0].foreign_id;
                  var source = fid.split(':')[2];
                  $('#api').rdio().queue(source);
                });
                $('#api').rdio().play();
              });
          });
      });
    });
  </script>
</head>
<body>
  <div id="api"></div>
  <img id="art" src="" height="200" width="200" style="float:left;margin-right:20px;">
  <div>
    <div><b>Track: </b><span id="track"></span></div>
    <div><b>Album: </b><span id="album"></span></div>
    <div><b>Artist: </b><span id="artist"></span></div>
    <div><b>Position: </b>
      <span style="display:inline-block;width:200px;border:1px solid black;">
        <span id="position" style="display:inline-block;background-color:#666">&nbsp;</span>
      </span></div>
    <div>
      <button id="previous">&lt;&lt;</button>
      <button id="play">|&gt;</button>
      <button id="pause">||</button>
      <button id="next">&gt;&gt;</button>
    </div>
  </div>
</body>
</html>